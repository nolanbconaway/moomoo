
version: 2

models:
  - name: local_files
    description: |
      Local library file metadata, generated by the ingest script.
      Expect much of these data to be messy, as the tags are very hand entered.
    columns:
      - name: filepath
        tests:
          - not_null
          - unique
      - name: recording_md5
        tests:
          - dbt_utils.not_null_proportion:
              arguments:
                at_least: 0.85  # test nothing pathologically wrong with ingest.
      - name: file_created_at
        description: |
          Least of file ctime, mtime. This is done due to platform differences in what
          those stamps mean.
        tests:
          - not_null
      - name: track_name
      - name: album_name
      - name: artist_name
      - name: album_artist_name
      - name: track_date
      - name: track_year
        description: First 4 caracters of the date. Skipped if not integers.
      - name: track_length_seconds
      - name: recording_mbid
      - name: release_mbid
      - name: artist_mbid
      - name: release_group_mbid
      - name: album_artist_mbid
      - name: insert_ts_utc
        tests:
          - not_null

      - name: embedding_success
        tests:
          - dbt_utils.not_null_proportion:
              arguments:
                at_least: 0.5  # test nothing pathologically wrong with the ingest/join.
      - name: embedding_duration_seconds
      - name: embedding
      - name: embedding_insert_ts_utc
