
version: 2

models:
  - name: listens
    description: Base model which extracts JSON from the source listens table.
    columns:
      - name: listen_md5
        description: The unique md5 of the listen event, generated by the ingestion script.
        tests:
          - not_null
          - unique
      - name: username
        tests:
          - not_null
      - name: listen_at_ts_utc
        tests:
          - not_null
      - name: recording_msid
        tests:
          - not_null
      - name: track_name
      - name: artist_name
      - name: release_name
      - name: release_mbid
      - name: recording_mbid
      - name: artist_mbids
      - name: caa_release_mbid
      - name: duration_ms
      - name: tracknumber
      - name: _lb_insert_ts_utc
        description: |
          Timestamp of the last update for the listen in listenbrainz. May be later than
          the listen timestamp if, e.g., missing mbids are added.
        tests:
          - not_null
      - name: _ingest_insert_ts_utc
        tests:
          - not_null

  - name: listenbrainz_feedback
    description: Basic view on the feedback table.
    columns:
      - name: feedback_md5
        tests:
          - not_null
          - unique
      - name: username
        tests:
          - not_null
      - name: score
        tests:
          - not_null
      - name: recording_mbid
        tests:
          - not_null
      - name: feedback_at
        tests:
          - not_null
      - name: _ingest_insert_ts_utc
        tests:
          - not_null

  - name: similar_user_activity
    description: Listen counts for similar users across different entities and time ranges.
    columns:
      - name: similar_user_activity_id
        tests:
          - not_null
          - unique
      - name: mbid
        tests:
          - not_null
      - name: listen_count
        tests:
          - not_null
      - name: from_username
        tests:
          - not_null
      - name: to_username
        tests:
          - not_null
      - name: user_similarity
        tests:
          - not_null
      - name: activity_from_ts
        tests:
          - not_null
      - name: activity_to_ts
        tests:
          - not_null
      - name: entity
        tests:
          - not_null
      - name: ingest_payload_id
        description: Hash of (from, to, entity, time range).
        tests:
          - not_null
      - name: insert_ts_utc
        tests:
          - not_null

  - name: messybrainz_name_map
    description:  Mapped data from local files to listenbrainz lookups.
    columns:
      - name: recording_md5
        tests:
          - not_null
          - unique
      - name: recording_name
        tests:
          - not_null
      - name: artist_name
        tests:
          - not_null
      - name: release_name
        tests:
          - not_null
      - name: artist_mbids
      - name: recording_mbid
      - name: release_mbid
      - name: release_group_mbid
      - name: mapped_release_name
      - name: mapped_recording_name
      - name: mapped_artist_name
      - name: insert_ts_utc
        tests:
          - not_null